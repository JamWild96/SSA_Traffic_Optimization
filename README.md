# SSA Project Map - Hybrid C/Python Implementation

A complete implementation of the Sparrow Search Algorithm (SSA) for route optimization with advanced visualization capabilities. This project uses C for data generation and optimization with Python for visualization.

## Project Overview

This project implements the Sparrow Search Algorithm (SSA) for solving the Traveling Salesman Problem (TSP) and similar route optimization challenges. It features:

- **High-performance C implementation** for graph generation, SSA optimization, and data output
- **Python visualization tools** for histogram analysis, visit heatmaps, and traffic simulation
- **Integrated workflow** managed through a comprehensive Makefile
- **Multiple visualization outputs** including route maps, visit frequency analysis, and traffic simulation

## Project Structure

```
ssa_project_map/
├── Makefile                    # Main build and execution workflow
├── README.md                   # This file
├── TODO.md                     # Project todos
├── venv/                       # Python virtual environment
├── c_src/                      # C source code
│   ├── main.c                  # Main C program (graph generation + SSA algorithm)
│   ├── graph.c/.h              # Graph data structure and I/O
│   └── ssa.c/.h                # SSA algorithm implementation
├── python/                     # Python visualization scripts
│   ├── draw_map.py             # Traffic simulation visualization
│   ├── generate_histogram.py   # Visit frequency analysis and heatmaps
│   ├── requirements.txt        # Python dependencies
│   └── README.md               # Python-specific documentation
├── places.csv                  # Sample building/landmark data (generated by C)
├── jams.csv                    # Sample traffic jam data (generated by C)
├── graph.csv                   # Graph adjacency matrix (generated by C)
├── coords.csv                  # Node coordinates (generated by C)
├── best_route.txt              # Optimized route (generated by C)
├── visit_matrix.txt            # Visit frequency data (generated by C)
├── node_visits.txt             # Node visit counts (generated by C) 
└── route_stats.txt             # Optimization statistics (generated by C)
```

## Setup Instructions

### Prerequisites

- GCC compiler (C17 standard support)
- Python 3.8+ 
- Make utility

### Installation

1. **Clone and navigate to the project:**
   ```bash
   cd CS_495/Separate_Test/ssa_project_map
   ```

2. **Set up Python virtual environment:**
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # On macOS/Linux
   # or
   venv\Scripts\activate     # On Windows
   ```

3. **Install Python dependencies:**
   ```bash
   pip install -r python/requirements.txt
   ```

## Usage

### Quick Start

Run the complete workflow with default parameters:
```bash
make all
```

This will:
1. Build the C program
2. Run the C program to generate graph data and find optimal route
3. Create visualizations (histogram, heatmap, and traffic map)

### Individual Steps

#### 1. Build C Program
```bash
make build
```
Compiles the C program (`ssa_sim`).

#### 2. Run Graph Generation and Optimization
```bash
make run
```
Executes the C program, which:
- Generates random graph with specified nodes and density
- Creates coordinates for visualization
- Runs SSA optimization to find best route
- Outputs data files for analysis:
  - `graph.csv` - Adjacency matrix
  - `coords.csv` - Node coordinates
  - `best_route.txt` - Optimal route found
  - `visit_matrix.txt` - Node visit frequency matrix
  - `node_visits.txt` - Aggregated visit counts per node
  - `route_stats.txt` - Optimization statistics
  - `places.csv` - Sample building outlines
  - `jams.csv` - Sample traffic jams

#### 3. Create Visualizations
```bash
make histogram
make map
```
Or both at once:
```bash
make visualize
```

These steps create:
- `visit_histogram.png` - Bar chart of node visit frequencies
- `visit_heatmap.png` - Heatmap of the visit matrix
- `map.png` - Traffic simulation with route, buildings, and jams

### Custom Parameters

#### C Program Execution
```bash
# Run with custom parameters (50 nodes, 0.3 density)
make custom NODES=50 DENSITY=0.3

# Or directly run the C program:
./ssa_sim graph.csv best_route.txt 50 0.3
```

### Maintenance Commands

#### Cleaning Generated Files
```bash
# Remove all generated output files
make clean

# Remove all generated files plus the virtual environment
make deep-clean

# Complete cleanup (includes system files like .DS_Store)
make distclean
```

#### Complete Rebuild
```bash
# Rebuild everything from scratch (including venv setup)
make rebuild
```

#### Help
```bash
# Display available commands
make help
```

#### Histogram Analysis
```bash
# Customize visualization output
venv/bin/python python/generate_histogram.py \
    --matrix visit_matrix.txt \
    --visits node_visits.txt \
    --histogram custom_histogram.png \
    --heatmap custom_heatmap.png \
    --print-stats
```

#### Traffic Simulation
```bash
venv/bin/python python/draw_map.py \
    --graph graph.csv \
    --coords coords.csv \
    --route best_route.txt \
    --places places.csv \
    --jams jams.csv \
    --output custom_map.png \
    --show
```

## File Formats

### Graph CSV Format (generated by C program)
```
n
w11,w12,...,w1n
w21,w22,...,w2n
...
wn1,wn2,...,wnn
```
Where `n` is the number of nodes and `wij` is the weight of edge from node i to node j (0 if no edge).

### Coordinates CSV Format
```
node,x,y
0,0.123,0.456
1,0.789,0.012
...
```

### Route Format
```
node_id_1
node_id_2
...
node_id_n
```

### Buildings CSV Format
```
name,x1,y1,x2,y2
School,0.1,0.1,0.3,0.3
Hospital,0.6,0.7,0.9,0.9
```

### Traffic Jams CSV Format
```
source_node,destination_node
0,1
2,3
```

## Algorithm Parameters

### C Implementation (ssa.c)
- **Population Size**: 50 sparrows
- **Max Iterations**: 200
- **Producer Ratio**: 20% of population
- **Danger Awareness**: 10% random jumps per iteration

### Python Implementation (map_generator.py)
- **Default Nodes**: 10
- **Default Density**: 0.6
- **Default Iterations**: 50
- **Default Population**: 20

## Output Files

### Generated by C Program
- `ssa_sim` - Compiled executable
- `graph.csv` - Graph adjacency matrix
- `coords.csv` - Node coordinates
- `places.csv` - Sample building outlines
- `jams.csv` - Sample traffic jams
- `best_route.txt` - Optimal route (node sequence)
- `visit_matrix.txt` - Edge visit frequency matrix
- `node_visits.txt` - Per-node visit counts
- `route_stats.txt` - Optimization statistics

### Generated by Python Scripts
- `visit_histogram.png` - Node visit frequency bar chart
- `visit_heatmap.png` - Visit matrix heatmap
- `map.png` - Complete traffic simulation map

## Fixed Issues

This project has been completely debugged and the following issues were resolved:

### 1. C Code Memory Management
- **Issue**: Uninitialized sparrow routes and memory leaks
- **Fix**: Proper malloc allocation for routes, initialization with random permutations

### 2. SSA Algorithm Logic
- **Issue**: Incomplete producer/scrounger/danger-awareness implementation
- **Fix**: Complete algorithm with proper sorting, copying, and mutation operations

### 3. CSV Parsing
- **Issue**: Incorrect comma handling in graph file parsing
- **Fix**: Proper CSV format parsing with comma detection

### 4. Architecture Restructuring
- **Issue**: Mixed responsibilities between C and Python code
- **Fix**: Centralized data generation in C with Python only for visualization

### 5. Build System
- **Issue**: Makefile referenced non-existent files and wrong paths
- **Fix**: Complete Makefile with proper virtual environment handling

### 6. Environment Setup
- **Issue**: NumPy/Matplotlib version conflicts
- **Fix**: Isolated virtual environment with compatible package versions

### 7. Visualization Pipeline
- **Issue**: Missing histogram generation from C program output
- **Fix**: New histogram generation script with comprehensive statistics and direct data exports from C program

## Performance Notes

- **C Implementation**: Optimized for speed, handles graphs with 100+ nodes efficiently
- **Memory Usage**: O(n²) for adjacency matrix and visit tracking
- **Python Visualization**: May be slower for very large graphs (>1000 nodes)

## Troubleshooting

### "Virtual environment not found"
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r python/requirements.txt
```
Or use the automated rebuild:
```bash
make rebuild
```

### "Graph file not found" or "Visit matrix not found"
Run `make run` to execute the C program which generates all necessary data files.

### "Visualization failed"
Make sure the virtual environment is active and all Python dependencies are installed.

### Compilation errors
Ensure GCC supports C17 standard:
```bash
gcc --version
```

### Clean start required
If you need a completely fresh start:
```bash
make distclean
make all
```

## Contributing

1. C code follows C17 standard
2. Python code follows PEP 8 style guidelines
3. All new features should include corresponding Makefile targets
4. Test with both small (10 nodes) and medium (50 nodes) graphs

## License

This project is part of CS 495 coursework. Please respect academic integrity policies when using or referencing this code.

## Authors

- Original SSA implementation and optimization algorithms
- Python visualization and integration layer
- Comprehensive build system and workflow automation

---

For technical questions or issues, please refer to the individual README files in the `python/` directory or examine the source code comments for detailed implementation notes.
